
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python decorator for OpenTracing trace generation.">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.6">
    
    
      
        <title>Quickstart - Opentracing Decorator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quickstart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Opentracing Decorator" class="md-header-nav__button md-logo" aria-label="Opentracing Decorator">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Opentracing Decorator
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Quickstart
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/doughepi/opentracing-decorator" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    doughepi/opentracing-decorator
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Opentracing Decorator" class="md-nav__button md-logo" aria-label="Opentracing Decorator">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Opentracing Decorator
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/doughepi/opentracing-decorator" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    doughepi/opentracing-decorator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Quickstart
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Quickstart
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-tracing" class="md-nav__link">
    Simple Tracing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obtain-span-reference" class="md-nav__link">
    Obtain Span Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-parameter-tagging" class="md-nav__link">
    Automatic Parameter Tagging
  </a>
  
    <nav class="md-nav" aria-label="Automatic Parameter Tagging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabling-parameter-tagging" class="md-nav__link">
    Enabling parameter tagging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-tag-prefix" class="md-nav__link">
    Adding a tag prefix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-return-value-logging" class="md-nav__link">
    Automatic Return Value Logging
  </a>
  
    <nav class="md-nav" aria-label="Automatic Return Value Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabling-return-value-logging" class="md-nav__link">
    Enabling return value logging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-return-prefix" class="md-nav__link">
    Adding a return prefix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-tracing" class="md-nav__link">
    Simple Tracing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obtain-span-reference" class="md-nav__link">
    Obtain Span Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-parameter-tagging" class="md-nav__link">
    Automatic Parameter Tagging
  </a>
  
    <nav class="md-nav" aria-label="Automatic Parameter Tagging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabling-parameter-tagging" class="md-nav__link">
    Enabling parameter tagging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-tag-prefix" class="md-nav__link">
    Adding a tag prefix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-return-value-logging" class="md-nav__link">
    Automatic Return Value Logging
  </a>
  
    <nav class="md-nav" aria-label="Automatic Return Value Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabling-return-value-logging" class="md-nav__link">
    Enabling return value logging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-return-prefix" class="md-nav__link">
    Adding a return prefix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="quickstart">Quickstart</h1>
<h2 id="simple-tracing">Simple Tracing</h2>
<p>Get the package from PyPI.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>pip install opentracing-decorator
</code></pre></div>
</td></tr></table>
<p>Import and define an instance of the Opentracing Decorator class.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># examples/simple.py</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">jaeger_client</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="kn">from</span> <span class="nn">opentracing_decorator</span> <span class="kn">import</span> <span class="n">Tracing</span>

<span class="c1"># No sampler host and port specified because the Jaeger client picks localhost:6831 by default.</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;sampler&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;const&quot;</span><span class="p">,</span>  <span class="c1"># Not advised to have constant sampling in production.</span>
            <span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">service_name</span><span class="o">=</span><span class="s2">&quot;example-service&quot;</span><span class="p">,</span>
    <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">jaeger_tracer</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">initialize_tracer</span><span class="p">()</span>

<span class="c1"># Pass in an instance of a tracer implementation.</span>
<span class="c1"># Here, we&#39;re using the Jaeger client.</span>
<span class="n">tracing</span> <span class="o">=</span> <span class="n">Tracing</span><span class="p">(</span><span class="n">tracer</span><span class="o">=</span><span class="n">jaeger_tracer</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>Here, we're using the <a href="https://github.com/jaegertracing/jaeger-client-python">Jaeger implementation of
OpenTracing</a> for
integration with the Jaeger tracing system. You can use any OpenTracing
compatible tracer. For example, the <a href="https://github.com/lookfwd/zipkin-python-opentracing">Zipkin OpenTracing
client</a></p>
<p>I can now annotate any function I want, in order to start generating and pushing traces to the Jaeger server.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># examples/simple.py</span>

<span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;MyOperationName&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_some_work</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
</code></pre></div>
</td></tr></table>
<p>Be sure to give the tracer time to report traces so it can clear its buffers
before exiting. Although, the worst thing that could happen if you forget this
is that some of your traces will not show up.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># examples/simple.py</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">do_some_work</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

    <span class="c1"># Give some time to report traces.</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">jaeger_tracer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>At this point, you should see traces start to show up in the user interface.</p>
<p><img alt="Screenshot of Jaeger UI after running the simple example." src="../img/simple-example.png" /></p>
<h2 id="obtain-span-reference">Obtain Span Reference</h2>
<p>It's generally helpful to access the active Span while doing any sort of processing. This is so that you can do things like add tags, log arbitrary key/value information, etc.</p>
<p>You can configure the Opentracing Decorator to pass a reference to the Span you are within by passing the <code>pass_span=True</code> argument to the decorator.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;MyOperationName&quot;</span><span class="p">,</span> <span class="n">pass_span</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_some_work</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span>
    <span class="n">span</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
    <span class="n">span</span><span class="o">.</span><span class="n">log_kv</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
</td></tr></table>
<p>If you only desire access to the Span to tag function
parameters and log function return values--take a look at the automatic
parameter tagging feature for an easier way to do this.</p>
<h2 id="automatic-parameter-tagging">Automatic Parameter Tagging</h2>
<h3 id="enabling-parameter-tagging">Enabling parameter tagging</h3>
<p>You can configure the Opentracing Decorator to automatically tag function Spans
with the names and values of the function arguments.</p>
<p>To clarify, if we have a function like this</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;GetData&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>we may want to see the values for <code>method</code>, <code>url</code>, and <code>headers</code> in our Span
tags.</p>
<p>Simply set the <code>tag_parameters</code> flag on the decorator.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># examples/automatic_parameter_tagging.py</span>

<span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;GetData&quot;</span><span class="p">,</span> <span class="n">tag_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>Now our function parameters are tagged and added to the span.</p>
<p><img alt="Image of a span automatically tagged with function
parameters." src="../img/automatic-parameter-tagging.png" /></p>
<h3 id="adding-a-tag-prefix">Adding a tag prefix</h3>
<p>You can set a tag prefix by using the <code>parameter_prefix</code> argument to the decorator.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;GetData&quot;</span><span class="p">,</span> <span class="n">tag_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parameter_prefix</span><span class="o">=</span><span class="s1">&#39;devops&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>This will put <code>devops.*</code> in front of every automatically tagged parameter. This
is useful for avoiding collisions with tags from other applications.</p>
<h2 id="automatic-return-value-logging">Automatic Return Value Logging</h2>
<h3 id="enabling-return-value-logging">Enabling return value logging</h3>
<p>You can configure the Opentracing Decorator to automatically log function return values to the Span.</p>
<p>To clarify, if we have a function like this</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;GetData&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>we may want to see log the return value from the api request to our Span for future analysis.</p>
<p>Simply set the <code>tag_parameters</code> flag on the decorator.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># examples/automatic_return_value_logging.py</span>

<span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;GetTime&quot;</span><span class="p">,</span> <span class="n">log_return</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>Now our function return value is logged to the Span.</p>
<p><img alt="Image of a span with the function return value automatically logged to it." src="../img/automatic-return-value-logging.png" /></p>
<h3 id="adding-a-return-prefix">Adding a return prefix</h3>
<p>You can set a return prefix by using the <code>return_prefix</code> argument to the decorator.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nd">@tracing</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">operation_name</span><span class="o">=</span><span class="s2">&quot;GetTime&quot;</span><span class="p">,</span> <span class="n">log_return</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_prefix</span><span class="o">=</span><span class="s1">&#39;devops.return&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </div>
            </div>
          </a>
        
        
          <a href="../api/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>